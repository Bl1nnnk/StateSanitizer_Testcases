Pdh接口测试用例环境准备

Overview

pdh性能数据帮助程序接口，提供了一组功能，用于收集和分析计算机上运行的应用程序和系统的性能数据。这些接口允许开发人员编写应用程序和服务，以收集和监视各种性能计数器，如 CPU 使用率、内存使用率、磁盘 I/O、网络流量等等。使用这些接口可以帮助开发人员了解系统的运行状况和性能瓶颈，从而进行优化和调整。

Pdh系统分为几部分：

1. counter 计数器是单个性能数据段的定义。 计数器具有名称和类型。 例如，“每数据库统计信息”计数器集可能包含类型为“每秒事务” PERF_COUNTER_COUNTER的计数器。
	使用 Windows 自带的性能监视器创建，可以通过以下步骤创建counter：
    * 打开“性能监视器”应用程序。
    * 在左侧导航栏中找到“性能监视器”节点，并右键单击，选择“添加计数器”。
    * 在“添加计数器”对话框中，选择要监视的计算机对象和计数器分类。
    * 在计数器分类下选择要监视的性能计数器，可以选择多个计数器。
    * 点击“添加”按钮，将计数器添加到监视器中。
    * 可以设置采样间隔和计数器显示方式。
    * 点击“确定”按钮。

2. log日志文件 是用于记录计数器数据的文件。 可以使用性能监视器将计数器数据保存到日志文件中，然后使用 pdh API 读取和分析文件中的数据。 日志文件还可以用于跨多个计算机比较性能数据。 
3. query 创建从实时源或日志文件收集性能数据的查询，通过查询可以实时监视系统的性能、进行性能分析和优化，提高系统的性能和稳定性。

4. Datasource 性能数据， 可以分为实时数据和日志文件

测试用例环境准备和注意事项

1. 创建性能计数器采集日志
	使用 Windows 自带的性能监视器创建，可以通过以下步骤创建log：
    * 打开“性能监视器”（perfmon.exe）；
    * 选择“数据收集器集合”；
    * 右键单击“用户定义”；
    * 选择“新建数据收集器集合”；
    * 按照向导指示，输入数据收集器的名称和描述，选择要监控的计数器和采集间隔等参数；
	完成后会生成一个 .blg 或 .csv 文件，该文件可以作为数据源，可以在 PdhBindInputDataSourceA 函数中指定该文件的路径。

2. 一些接口如PdhBrowseCounters、PdhSelectDataSource等会出现交互式弹框，…
3.  pdhupdatelog等文件写入操作，如果文件需要管理员权限操作，会出现授权弹框
4. PdhConnectMachineA需要设置远程机器
5. 待补充…


测试用例编译
 cl.exe /EHsc /W4 /nologo  pdh.lib cpp_file
可以运行compile.bat批量编译test case

测试用例编译不通过的文件可以通过批处理命令打印出
@echo off

for %%i in (*.cpp) do (
    if not exist %%~ni.exe (
        echo %%i
    )
)

运行检查
测试用例的运行需要保证api接口有被正确的调用，可以通过接口返回状态来判断调用是否成功。
可以运行runcheck.bat批量检查接口运行状态

hypercall添加
运行addHypercall.py给testcase添加hypercall
